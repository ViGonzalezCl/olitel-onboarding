<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OLITEL Onboarding</title>
  <link rel="icon" href="logo-sm-64.png" type="image/png" />
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="web-files/bootstrap.min.css" />
  <style>
    body { font-family: sans-serif; margin:0; background:#f5f5f5; }
    header { background:#004b87; color:#fff; padding:1rem; text-align:center; }
    main { max-width:400px; margin:2rem auto; background:#fff; padding:1.5rem;
           border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,.1); }
    input, button { width:100%; padding:.75rem; margin-top:1rem; border-radius:4px;
                    border:1px solid #ccc; font-size:1rem; }
    button { background:#004b87; color:#fff; border:none; cursor:pointer; }
    .card { margin-top:1.5rem; padding:1rem; border:1px solid #eee; border-radius:6px; }
    .error { color:#c00; margin-top:1rem; }
  </style>
</head>
<body>
  <header>
    <h1>OLITEL Onboarding</h1>
  </header>
  <main>
    <p>Escanea tu QR o ingresa tu RUT:</p>
    <input id="rut" type="text" placeholder="Ej: 12345678-9" />
    <button id="go">Ver mi credencial</button>
    <div id="resultado"></div>
  </main>

  <script>
    (async () => {
      // 1) Carga el JSON con todos los datos
      const datos = await fetch('datos.json').then(res => res.json());

      const input = document.getElementById('rut');
      const btn   = document.getElementById('go');
      const out   = document.getElementById('resultado');

      // 2) Si llega ?id= en la URL, auto‑llenar y buscar
      const params = new URLSearchParams(window.location.search);
      if (params.has('id')) {
        input.value = params.get('id');
        buscar();
      }

      btn.addEventListener('click', buscar);

      function buscar() {
        out.innerHTML = '';
        let raw = input.value.trim();
        if (!raw) {
          out.innerHTML = '<p class="error">Ingresa un RUT válido.</p>';
          return;
        }
        // Limpia puntos y guión
        const clean = raw.replace(/[.\-]/g, '');
        // Reconstruye con guión
        if (clean.length < 2) {
          out.innerHTML = '<p class="error">RUT demasiado corto.</p>';
          return;
        }
        const dv = clean.slice(-1), num = clean.slice(0, -1);
        const key = `${num}-${dv}`;

        const u = datos[key];
        if (!u) {
          out.innerHTML = '<p class="error">RUT no encontrado.</p>';
          return;
        }

        out.innerHTML = `
          <div class="card">
            <h3>${u.nombre}</h3>
            <p><strong>Correo:</strong> ${u.correo}</p>
            <p><strong>Clave:</strong> ${u.clave}</p>
          </div>
        `;
      }
    })();
  </script>
</body>
</html>
